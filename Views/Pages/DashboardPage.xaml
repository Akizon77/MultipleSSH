<Page
    x:Class="MultipleSSH.Views.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:MultipleSSH.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:MultipleSSH.Models"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    Title="DashboardPage"
    d:DataContext="{d:DesignInstance local:DashboardPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    xmlns:helper="clr-namespace:MultipleSSH.Helpers"
    Name="dashboardPage"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">
    <Page.Resources>
        <helper:BoolToVisbilityConverter x:Key="BoolToVisbilityConverter"/>
        <helper:BindProxy x:Key="Page" Data="{Binding ElementName=dashboardPage}"/>
    </Page.Resources>
    <Grid>
        <Grid.ColumnDefinitions>

        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="60"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>


        <Grid Grid.Row="0">
            <TextBlock
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                FontWeight="DemiBold"
                FontSize="40"
                Text="辛苦啦！"/>
            <Label
                FontFamily="Microsoft YaHei UI"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                FontWeight="Regular"
                Content="成长是悄无声息的!"/>
        </Grid>



        <Grid Grid.Row="1">
            <Grid HorizontalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <DockPanel Margin="0,8,80,0">
                        <ui:Button Margin="8,0" Appearance="Success">
                            <DockPanel>
                                <ui:SymbolIcon Symbol="Add24"/>
                                <TextBlock 
                                    Margin="8,0"
                                    Text="添加"/>
                            </DockPanel>
                        </ui:Button>
                        <ui:AutoSuggestBox PlaceholderText="搜索..."/>
                    </DockPanel>
                    <ItemsControl ItemsSource="{Binding ViewModel.Hosts,Mode=TwoWay}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border
                                Padding="8"
                                BorderThickness="2"
                                CornerRadius="4"
                                Background="{StaticResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                Margin="4,16,80,0">
                                    <Grid>
                                        <StackPanel Orientation="Vertical">
                                            <TextBlock
                                              Name="connectTo"
                                              FontWeight="SemiBold"
                                              FontSize="22">
                                        
                                        <Run Name="fname" Text="{Binding FriendlyName}"/>
                                            </TextBlock>

                                            <TextBlock FontSize="14" Margin="0,4">
                                              <Run Text="验证方式:"/>
                                              <Run Text="{Binding LoginMethod}"/>
                                                <Run Text="  端口:"/>
                                              <Run Text="{Binding Port}"/>
                                            </TextBlock>
                                            <TextBlock FontSize="14" Margin="0,4">
                                              <Run Text="主机:"/>
                                              <Run Text="{Binding Host}"/>

                                            </TextBlock>
                                            <!-- 右下角删除和连接 -->
                                            <DockPanel>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                                    <ui:Button
                                                    Margin="8,0"
                                                    Appearance="Info"
                                                        Command="{Binding Source={StaticResource Page},Path=Data.ViewModel.ConnectCommand}"
                                                    CommandParameter="{Binding RelativeSource={RelativeSource Mode=Self}, Path=DataContext}"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Bottom">
                                                        <ui:SymbolIcon Symbol="Open24"/>
                                                    </ui:Button>
                                                    <ui:Button
                                                    Margin="0"
                                                        Visibility="Collapsed"
                                                    Appearance="Info"
                                                    CommandParameter="{Binding RelativeSource={RelativeSource Mode=Self}, Path=DataContext}"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Bottom">
                                                        <ui:SymbolIcon Symbol="Remote16"/>
                                                    </ui:Button>
                                                    <ui:Button
                                                    Appearance="Caution"
                                                        Margin="8,0,0,0"
                                                    HorizontalAlignment="Right"
                                                    CommandParameter="{Binding RelativeSource={RelativeSource Mode=Self}, Path=DataContext}"
                                                    VerticalAlignment="Bottom">
                                                        <!-- 删除 -->
                                                        <i:Interaction.Triggers>
                                                            <i:EventTrigger EventName="Click">
                                                                <i:RemoveItemInListBoxAction />
                                                            </i:EventTrigger>
                                                        </i:Interaction.Triggers>
                                                        <ui:SymbolIcon Symbol="Delete24"/>
                                                    </ui:Button>
                                                </StackPanel>
                                            </DockPanel>
                                        </StackPanel>
                                        <ui:Button
                                        CommandParameter="{Binding RelativeSource={RelativeSource Mode=Self}, Path=DataContext}"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top">
                                            <ui:SymbolIcon Symbol="Edit24"/>
                                        </ui:Button>

                                    </Grid>
                                </Border>

                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>


                <!--#region 快速连接 -->
                <Border 
                    Grid.Column="1"
                Padding="2"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                CornerRadius="4"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="2">
                    <i:Interaction.Behaviors>
                        <i:MouseDragElementBehavior/>
                    </i:Interaction.Behaviors>
                    <StackPanel Margin="8" Orientation="Vertical">
                        <TextBlock 
                        FontSize="22"
                        Margin="4"
                        FontWeight="Black"
                        Text="快速连接"/>
                        <DockPanel Margin="4" VerticalAlignment="Center">
                            <TextBlock
                            FontSize="16"
                            Margin="0,0,8,0"
                            VerticalAlignment="Center"
                            Text="主机"/>
                            <ui:TextBox
                            HorizontalAlignment="Stretch"
                            Text="{Binding ViewModel.FastHost,Mode=TwoWay}"
                            PlaceholderText="example.com"/>

                        </DockPanel>
                        <DockPanel Margin="4" VerticalAlignment="Center">
                            <TextBlock
                            FontSize="16"
                            Margin="0,0,8,0"
                            VerticalAlignment="Center"
                            Text="端口"/>
                            <ui:NumberBox
                            MinWidth="60"
                            Text="{Binding ViewModel.FastPort,Mode=TwoWay}"
                            ClearButtonEnabled="False"
                            HorizontalAlignment="Stretch"
                            PlaceholderText="22"/>
                            <TextBlock
                            FontSize="16"
                            Margin="8,0"
                            VerticalAlignment="Center"
                            Text="验证方式"/>
                            <ComboBox
                            Name="verifyMethod"
                            HorizontalAlignment="Stretch"
                            SelectedIndex="{Binding ViewModel.FastVerigyMethod,Mode=TwoWay}">
                                <!-- 前台能解决就交给前台做 -->
                                <i:Interaction.Triggers>
                                    <i:DataTrigger 
                                        Binding="{Binding RelativeSource={RelativeSource AncestorType=ComboBox}, Path=SelectedIndex}"
                                        Value="0">
                                        <i:ChangePropertyAction TargetName="pwdGrid" PropertyName="Visibility" Value="Visible"/>
                                        <i:ChangePropertyAction TargetName="keyGrid" PropertyName="Visibility" Value="Collapsed"/>
                                    </i:DataTrigger>
                                    <i:DataTrigger 
                                        Binding="{Binding RelativeSource={RelativeSource AncestorType=ComboBox}, Path=SelectedIndex}"
                                        Value="1">
                                        <i:ChangePropertyAction TargetName="pwdGrid" PropertyName="Visibility" Value="Collapsed"/>
                                        <i:ChangePropertyAction TargetName="keyGrid" PropertyName="Visibility" Value="Visible"/>
                                    </i:DataTrigger>
                                </i:Interaction.Triggers>

                                <ComboBoxItem Name="pwdBox" Content="密码"/>
                                <ComboBoxItem Name="keyBox" Content="私钥"/>
                            </ComboBox>
                        </DockPanel>
                        <DockPanel Margin="4">
                            <TextBlock
                            FontSize="16"
                            Margin="0,0,8,0"
                            VerticalAlignment="Center"
                            Text="用户名"/>
                            <ui:TextBox
                            HorizontalAlignment="Stretch"
                            Text="{Binding ViewModel.FastUsername,Mode=TwoWay}"
                            PlaceholderText="root"/>
                        </DockPanel>
                        <Grid 
                        Visibility="Visible"
                            Name="pwdGrid"
                        Margin="4" 
                        VerticalAlignment="Center">
                            <TextBlock
                            FontSize="16"
                            VerticalAlignment="Center"
                            Text="密码"/>
                            <ui:PasswordBox 
                            Password="{Binding ViewModel.FastPwd,Mode=TwoWay}"
                            HorizontalAlignment="Stretch"
                            Margin="50,0,0,0"
                            PlaceholderText="Password" Cursor="IBeam"/>
                        </Grid>
                        <Grid 
                        Name="keyGrid"
                        Visibility="Collapsed"
                        Margin="4" 
                        VerticalAlignment="Center">
                            <DockPanel>
                                <TextBlock
                                FontSize="16"
                                VerticalAlignment="Center"
                                Text="选择私钥"/>
                                <ui:TextBox
                                Text="{Binding ViewModel.FastKeyPath,Mode=TwoWay}"
                                HorizontalAlignment="Stretch"
                                MaxWidth="220"
                                Margin="8,0,42,0"
                                PlaceholderText="C:\Example"/>
                            </DockPanel>
                            <ui:Button
                            Content="..."
                            Command="{Binding ViewModel.FastSelectPrivateKeyCommand}"
                            HorizontalAlignment="Right"/>

                        </Grid>
                        <ui:Button
                        Appearance="Primary"
                        Margin="4"
                        Content="Go"
                        Command="{Binding ViewModel.FastConnectCommand}"
                        HorizontalAlignment="Stretch"/>

                    </StackPanel>
                </Border>
                <!--#endregion-->

            </Grid>


            <!--右下角提示-->
            <ui:ClientAreaBorder
                Padding="8"
                Name="msgBoxAboutTerminalNotImplited"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Visibility="Visible"
                Background="{StaticResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="2"
                CornerRadius="4">
                <i:Interaction.Behaviors>
                    <i:MouseDragElementBehavior/>
                </i:Interaction.Behaviors>
                <StackPanel>
                    <DockPanel>
                        <ui:SymbolIcon 
                            FontSize="22"
                            Symbol="Info16" 
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            FontWeight="Regular"
                            Foreground="#1a9ce2"/>
                        <TextBlock 
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            Margin="4,0"
                            FontWeight="Black"
                            FontSize="18"
                            Text="终端"/>
                        <!-- 关闭按钮 -->
                        <ui:Button 
                            HorizontalAlignment="Right"
                            BorderBrush="Transparent"
                            Appearance="Transparent">

                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="Click">
                                    <i:ChangePropertyAction TargetName="msgBoxAboutTerminalNotImplited" PropertyName="Visibility" Value="Collapsed"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>

                            <ui:SymbolIcon Symbol="Dismiss24">
                            </ui:SymbolIcon>
                        </ui:Button>
                    </DockPanel>
                    <TextBlock
                         Margin="4,8"
                            FontSize="12"
                        MaxWidth="280"
                            FontFamily="Microsoft YaHei UI"
                            TextWrapping="Wrap">
                            <Run Text="内嵌Windows Terminal正处于待开发状态。微软尚未对WPF独立添加WT控件。本项目使用ConPTY模拟终端，兼容性未知。"/>
                            <LineBreak/>
                            <Run Text="推荐使用Windows Terminal"/>
                    </TextBlock>
                    <DockPanel>
                        <ui:Anchor
                            Appearance="Info"
                            HorizontalAlignment="Right"
                            Content="安装 Windows Terminal"
                            NavigateUri="https://apps.microsoft.com/detail/windows-terminal/9N0DX20HK701"/>
                    </DockPanel>
                </StackPanel>
            </ui:ClientAreaBorder>

        </Grid>

    </Grid>
</Page>
